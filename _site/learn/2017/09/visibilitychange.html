<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Elaine blog</title>
	 <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" href="/blog/css/style.css">
	<link rel="stylesheet" href="/blog/css/highlight.css">
</head>
<body>
<header>
  <h1>Elaine <span>Blog<span></h1>
</header>     
<section class="container">
	<div class="arc-con">
		<h3 id="javascriptvisibilitychange"><strong>[Javascript]visibilitychange</strong></h3>

<h3 id="html5-api--页面可见性改变visibilitychange事件在当前网页在可见和不可见之间变换的时候调用这样便可适合在标签不可见的时候减少网络请求服务器压力等"><strong>HTML5 API — 页面可见性改变(visibilitychange)事件在当前网页在可见和不可见之间变换的时候调用，这样便可适合在标签不可见的时候减少网络请求、服务器压力等。</strong></h3>

<h3 id="目前页面可见性api有两个属性"><strong>目前页面可见性API有两个属性</strong></h3>

<p>document.hidden: Boolean值，表示当前页面可见还是不可见</p>

<p>document.visibilityState: 返回当前页面的可见状态</p>

<h3 id="改变网页标题的文字"><strong>改变网页标题的文字</strong></h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="no">OriginTitile</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">titleTime</span><span class="p">;</span>
    <span class="n">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s1">'visibilitychange'</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="p">.</span><span class="nf">hidden</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'悄悄的我走了！'</span><span class="p">;</span>
            <span class="n">clearTimeout</span><span class="p">(</span><span class="n">titleTime</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'(つェ⊂)轻轻地我来了!'</span><span class="p">;</span>
            <span class="n">titleTime</span> <span class="o">=</span> <span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="no">OriginTitile</span><span class="p">;</span>
            <span class="p">},</span><span class="mi">2000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">})();</span></code></pre></figure>

<h3 id="当应用程序或浏览器标签页切换到后台时就停止播放音乐从后台切换回来时又开始播放音乐"><strong>当应用程序或浏览器标签页切换到后台时就停止播放音乐，从后台切换回来时又开始播放音乐</strong></h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> 
<span class="o">&lt;</span><span class="n">audio</span> <span class="n">src</span><span class="o">=</span><span class="s2">"http://www.w3school.com.cn/i/horse.ogg"</span> <span class="n">controls</span><span class="o">=</span><span class="s2">"controls"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"audio"</span><span class="o">&gt;</span><span class="err">浏览器不支持</span><span class="o">&lt;</span><span class="sr">/audio&gt;
 
/</span><span class="o">/</span><span class="err">控制音频</span>
<span class="n">var</span> <span class="n">audio</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="s2">"audio"</span><span class="p">);</span>
<span class="n">audio</span><span class="p">.</span><span class="nf">play</span><span class="p">();</span>
<span class="n">audio</span><span class="p">.</span><span class="nf">loop</span><span class="o">=</span><span class="kp">true</span><span class="p">;</span>

<span class="n">function</span> <span class="n">changeAudio</span><span class="p">(</span><span class="n">event</span><span class="p">){</span>
    <span class="n">var</span> <span class="n">target</span><span class="o">=</span><span class="n">event</span><span class="p">.</span><span class="nf">target</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="nf">hidden</span><span class="p">){</span>
        <span class="n">audio</span><span class="p">.</span><span class="nf">pause</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">audio</span><span class="p">.</span><span class="nf">play</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s1">'visibilitychange'</span><span class="p">,</span><span class="n">changeAudio</span><span class="p">,</span><span class="kp">false</span><span class="p">);</span>
  </code></pre></figure>

<h3 id="登录同步"><strong>登录同步</strong></h3>

<p><strong>1.  去淘宝买东西，未登录状态下，进入首页。</strong></p>

<p><strong>2.  然后新窗口打开任意页面，登录并成功返回。</strong></p>

<p><strong>3.  再次访问刚才打开的首页，发现页面还是未登录状态，实际上用户已经登录了。</strong></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">//</span><span class="err">登录信息页</span>
<span class="o">&lt;</span><span class="nb">p</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"loginInfo"</span><span class="o">&gt;&lt;</span><span class="sr">/p&gt;
(function() {
    /</span><span class="o">/</span><span class="err">返回后显示登录用户名</span>
    <span class="n">var</span> <span class="n">loginInfo</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="s2">"loginInfo"</span><span class="p">);</span> 

    <span class="n">function</span> <span class="n">changePage</span><span class="p">(){</span> 
        <span class="n">var</span> <span class="n">username</span><span class="o">=</span><span class="n">localStorage</span><span class="p">.</span><span class="nf">name</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">username</span><span class="p">){</span>
            <span class="n">loginInfo</span><span class="p">.</span><span class="nf">innerHTML</span><span class="o">=</span><span class="s1">'欢迎回来，'</span><span class="o">+</span><span class="n">username</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">var</span> <span class="n">href</span><span class="o">=</span><span class="n">location</span><span class="p">.</span><span class="nf">href</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s2">"index"</span><span class="p">,</span><span class="s2">"login"</span><span class="p">);</span> 
            <span class="n">loginInfo</span><span class="p">.</span><span class="nf">innerHTML</span><span class="o">=</span><span class="s1">'您尚未登录，请&lt;a href="'</span><span class="o">+</span><span class="n">href</span><span class="o">+</span><span class="s1">'" target="_blank"&gt;登录&lt;/a&gt;'</span><span class="p">;</span>

        <span class="p">}</span> 
    <span class="p">}</span>

    <span class="sr">//</span><span class="err">首次进入页面</span>
    <span class="n">changePage</span><span class="p">();</span>

    <span class="sr">//</span><span class="err">切换页面回来</span>
    <span class="n">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s1">'visibilitychange'</span><span class="p">,</span><span class="n">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">document</span><span class="p">.</span><span class="nf">hidden</span><span class="p">){</span>
            <span class="n">changePage</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span><span class="kp">false</span><span class="p">);</span>


    <span class="sr">//</span><span class="err">关闭页面的时候清楚缓存</span>
    <span class="n">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s2">"unload"</span><span class="p">,</span><span class="n">function</span><span class="p">(){</span>
        <span class="n">localStorage</span><span class="p">.</span><span class="nf">removeItem</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span> 
    <span class="p">},</span><span class="kp">false</span><span class="p">);</span>
<span class="p">})();</span>

<span class="sr">//</span><span class="err">登录页面</span>
<span class="o">&lt;</span><span class="n">form</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"loginForm"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="err">用户名</span><span class="o">&lt;</span><span class="sr">/td&gt;&lt;td&gt;&lt;input type="text" placeholder="请输入用户名" name="username"&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="sr">/tr&gt;
        &lt;tr&gt;&lt;td&gt;密码&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"password"</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">"请输入密码"</span> <span class="nb">name</span><span class="o">=</span><span class="s2">"password"</span><span class="o">&gt;&lt;</span><span class="sr">/td&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="err">邮箱</span><span class="o">&lt;</span><span class="sr">/td&gt;&lt;td&gt;&lt;input type="email" placeholder="请输入邮箱" name="email"&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="sr">/tr&gt;
        &lt;tr&gt;&lt;td colspan="2"&gt;&lt;button type="submit" value="登录" name="submit"&gt;登录&lt;/</span><span class="n">button</span><span class="o">&gt;&lt;</span><span class="sr">/td&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sr">/table&gt;
&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

<span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">loginForm</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="s2">"loginForm"</span><span class="p">);</span> 
    <span class="n">loginForm</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">){</span>
        <span class="n">localStorage</span><span class="p">.</span><span class="nf">name</span><span class="o">=</span><span class="n">loginForm</span><span class="p">.</span><span class="nf">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">value</span><span class="p">;</span>
        <span class="n">alert</span><span class="p">(</span><span class="s2">"返回首页，您已登录"</span><span class="p">);</span>
        <span class="n">this</span><span class="p">.</span><span class="nf">reset</span><span class="p">();</span> 
        <span class="n">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
    <span class="p">})</span>
<span class="p">})();</span></code></pre></figure>


	</div>
</section>   
<footer>
	<p>Copyright &copy; 2017@Elaine Blog / All rights reserved.</p>
</footer>