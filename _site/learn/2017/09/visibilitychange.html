<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Elaine blog</title>
	 <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" href="/blog/css/style.css">
	<link rel="stylesheet" href="/blog/css/highlight.css">
</head>
<body>
<header>
  <h1>Elaine <span>Blog<span></h1>
</header>     
<section class="container">
	<div class="arc-con">
		<h3 id="javascriptvisibilitychange"><strong>[Javascript]visibilitychange</strong></h3>

<h3 id="html5-api--页面可见性改变visibilitychange事件在当前网页在可见和不可见之间变换的时候调用这样便可适合在标签不可见的时候减少网络请求服务器压力等"><strong>HTML5 API — 页面可见性改变(visibilitychange)事件在当前网页在可见和不可见之间变换的时候调用，这样便可适合在标签不可见的时候减少网络请求、服务器压力等。</strong></h3>

<h3 id="目前页面可见性api有两个属性"><strong>目前页面可见性API有两个属性</strong></h3>

<p>document.hidden: Boolean值，表示当前页面可见还是不可见</p>

<p>document.visibilityState: 返回当前页面的可见状态</p>

<h3 id="改变网页标题的文字"><strong>改变网页标题的文字</strong></h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="no">OriginTitile</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">titleTime</span><span class="p">;</span>
    <span class="n">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s1">'visibilitychange'</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="p">.</span><span class="nf">hidden</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'悄悄的我走了！'</span><span class="p">;</span>
            <span class="n">clearTimeout</span><span class="p">(</span><span class="n">titleTime</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'(つェ⊂)轻轻地我来了!'</span><span class="p">;</span>
            <span class="n">titleTime</span> <span class="o">=</span> <span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">document</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="no">OriginTitile</span><span class="p">;</span>
            <span class="p">},</span><span class="mi">2000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">})();</span></code></pre></figure>

<h3 id="当应用程序或浏览器标签页切换到后台时就停止播放音乐从后台切换回来时又开始播放音乐"><strong>当应用程序或浏览器标签页切换到后台时就停止播放音乐，从后台切换回来时又开始播放音乐</strong></h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span> <span class="n">onload</span><span class="o">=</span><span class="s2">"load()"</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">audio</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"audio_id"</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="n">source</span> <span class="n">src</span><span class="o">=</span><span class="s2">"demo-audio.mp3"</span><span class="o">/&gt;</span>
		<span class="o">&lt;</span><span class="n">source</span> <span class="n">src</span><span class="o">=</span><span class="s2">"demo-audio.ogg"</span><span class="o">/&gt;</span>
		<span class="no">Browser</span> <span class="n">can</span><span class="err">'</span><span class="n">t</span> <span class="n">support</span> <span class="no">Audio</span> <span class="n">tag</span><span class="p">.</span>
	<span class="nf">&lt;</span><span class="o">/</span><span class="n">audio</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
	<span class="n">var</span> <span class="n">audioElement</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="s2">"audio_id"</span><span class="p">);</span>
	<span class="n">function</span> <span class="n">onVisibilityChanged</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">var</span> <span class="n">hidden</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="nf">target</span><span class="p">.</span><span class="nf">webkitHidden</span><span class="p">;</span>
	  <span class="k">if</span> <span class="p">(</span><span class="n">hidden</span><span class="p">)</span>
	    <span class="n">audioElement</span><span class="p">.</span><span class="nf">pause</span><span class="p">();</span>
	  <span class="k">else</span>
	    <span class="n">audioElement</span><span class="p">.</span><span class="nf">play</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">function</span> <span class="nb">load</span><span class="p">()</span> <span class="p">{</span>
	  <span class="n">audioElement</span><span class="p">.</span><span class="nf">play</span><span class="p">();</span>
	  <span class="n">audioElement</span><span class="p">.</span><span class="nf">loop</span> <span class="o">=</span> <span class="kp">true</span><span class="p">;</span>
	  <span class="n">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s2">"webkitvisibilitychange"</span><span class="p">,</span> <span class="n">onVisibilityChanged</span><span class="p">,</span> <span class="kp">false</span><span class="p">);</span>
	<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script&gt;
&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/html&gt;</span></code></pre></figure>

<h3 id="page-visibility页面可见性-登录同步"><strong>Page Visibility(页面可见性) –登录同步</strong></h3>

<p><strong>1.  去淘宝买东西，未登录状态下，进入首页。</strong></p>

<p><strong>2.  然后新窗口打开任意页面，登录并成功返回。</strong></p>

<p><strong>3.  再次访问刚才打开的首页，发现页面还是未登录状态，实际上用户已经登录了。</strong></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">//</span><span class="err">登录信息页</span>
<span class="o">&lt;</span><span class="nb">p</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"loginInfo"</span><span class="o">&gt;&lt;</span><span class="sr">/p&gt;
(function() {
    if (typeof pageVisibility.hidden !== "undefined") {
        var eleLoginInfo = document.querySelector("#loginInfo");
        var funLoginInfo = function() {
            var username = localStorage.username || sessionStorage.username;
            if (username) {
                eleLoginInfo.innerHTML = '欢迎回来，&lt;strong&gt;' + username + '&lt;/s</span><span class="n">trong</span><span class="o">&gt;</span><span class="s1">';
                sessionStorage.username = username;
            } else {
                eleLoginInfo.innerHTML = '</span><span class="err">您尚未登录，请</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">target</span><span class="o">=</span><span class="s2">"_blank"</span> <span class="n">href</span><span class="o">=</span><span class="s2">"'+ location.href.replace("</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="s2">", "</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="s2">") +'"</span><span class="o">&gt;</span><span class="err">登录</span><span class="o">&lt;</span><span class="sr">/a&gt;';
            }    
        }
        pageVisibility.visibilitychange(function() {
            if (!this.hidden) funLoginInfo();
        });
        
        funLoginInfo();
        
        /</span><span class="o">/</span> <span class="err">页面关闭清除</span><span class="n">localStorage</span>
        <span class="n">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s2">"unload"</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">localStorage</span><span class="p">.</span><span class="nf">removeItem</span><span class="p">(</span><span class="s2">"username"</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">alert</span><span class="p">(</span><span class="s2">"弹框？？？没错，因为你的这个浏览器不支持Page Visibility API的啦！"</span><span class="p">);</span>    
    <span class="p">}</span>
<span class="p">})();</span>

<span class="sr">//</span><span class="err">登录页面</span>
<span class="o">&lt;</span><span class="n">form</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"loginForm"</span> <span class="n">action</span><span class="o">=</span><span class="s2">""</span> <span class="nb">method</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="err">用户名：</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nb">name</span><span class="o">=</span><span class="s2">"username"</span> <span class="n">required</span> <span class="sr">/&gt;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="err">密码：</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"password"</span> <span class="nb">name</span><span class="o">=</span><span class="s2">"password"</span> <span class="n">required</span> <span class="sr">/&gt;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="o">/&gt;&lt;</span><span class="sr">/p&gt;
&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

<span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">typeof</span> <span class="n">window</span><span class="p">.</span><span class="nf">screenX</span> <span class="o">===</span> <span class="s2">"number"</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">var</span> <span class="n">eleLoginForm</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="s2">"#loginForm"</span><span class="p">);</span>
        <span class="n">eleLoginForm</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">localStorage</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="s2">"input[name='username']"</span><span class="p">).</span><span class="nf">value</span><span class="p">;</span>
            <span class="n">alert</span><span class="p">(</span><span class="s2">"登录成功！现在可以回到刚才的页面了！"</span><span class="p">);</span>
            <span class="n">this</span><span class="p">.</span><span class="nf">reset</span><span class="p">();</span>
            <span class="n">e</span><span class="p">.</span><span class="nf">preventDefault</span><span class="p">();</span>
        <span class="p">},</span> <span class="kp">false</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">alert</span><span class="p">(</span><span class="s2">"弹框？？？没错，因为你的这个浏览器不支持HTML5表单的啦！"</span><span class="p">);</span>    
    <span class="p">}</span>
<span class="p">})();</span></code></pre></figure>


	</div>
</section>   
<footer>
	<p>Copyright &copy; 2017@Elaine Blog / All rights reserved.</p>
</footer>