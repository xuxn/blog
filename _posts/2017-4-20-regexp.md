---
categories: learn
layout: post-detail
title:  "正则表达式"
date:   2017-04-20 11:30:04 +0800
---




# 正则表达式

### 1. 定义正则表达式

#### 通过构造函数
 
第一个参数为正则表达式的文本内容，第二个参数表示匹配g（全文查找），i（忽略大小写） ，m（多行查找）


{% highlight ruby %}
var re = new RegExp();//RegExp是一个对象,和Aarray一样  
//但这样没有任何效果,需要将正则表达式的内容作为字符串传递进去  
re =new RegExp("a");//最简单的正则表达式,将匹配字母a  
re=new RegExp("a","i");//第二个参数,表示匹配时不分大小写  
{% endhighlight %}

#### 通过//，也就是两个斜杠

### 2. 正则表达式对象的常用属性和方法 


* test返回一个 Boolean 值，它指出在被查找的字符串中是否存在模式。如果存在则返回 true，否则就返回 false。

{% highlight ruby %}
re = /^a|bc$/;//将匹配开始位置的a或结束位置的bc  
str ="add";  
alert(re.test(str));//true 
{% endhighlight %}

* match找到一个或多个正则表达式的匹配。

{% highlight ruby %}
var str="1 plus 2 equal 3"
document.write(str.match(/\d+/g)) //1,2,3
{% endhighlight %}

* replace替换与正则表达式匹配的子串。 

{% highlight ruby %}
var re = /[a-z]$/;  
var str = "ab\ncdef";  
alert(str.replace(re,"#"));//ab\ncde# 
{% endhighlight %}

* search检索与正则表达式相匹配的值，返回stringObject 中第一个与 regexp 相匹配的子串的起始位置,当search方法没有找到匹配时,将返回-1。

{% highlight ruby %}
var str="Visit W3School!"
document.write(str.search(/W3School/)) //6
{% endhighlight %}

* lastIndex属性声明的是上一次匹配文本之后的第一个字符的位置,默认值是-1。

{% highlight ruby %}
var str = "The rain in ...";
var patt1 = new RegExp("ain", "g");

patt1.test(str)
document.write("Match found. index now at: " + patt1.lastIndex);  //8
{% endhighlight %}

### 3. 正则表达式中的特殊字符

#### 字符含义

“.” 代表任意字符

“^” 匹配一个输入或一行的开头，**/^a/匹配"an A"，而不匹配"An a" **

"$" 匹配一个输入或一行的结尾，**/a$/匹配"An a"，而不匹配"an A" **

"\*" 匹配前面元字符0次或多次，表示{0,} **/ba\*/将匹配"b,ba,baa,baaa" **

"+" 匹配前面元字符1次或多次，表示{1,} **/ba\+/将匹配"ba,baa,baaa"** 

"?" 匹配前面元字符0次或1次，表示{0,1} **/ba\？/将匹配b,ba **，可匹配，可不匹配，优先是可匹配

"(x)" 匹配x保存x在名为$1...$9的变量，（）得到的是子表达式 

"x|y "匹配x或y 

"{n} "精确匹配n次 

"{n,}" 匹配n次以上 

"{n,m}" 匹配n-m次 

"[xyz]" 字符集(character set)，匹配这个集合中的任一一个字符(或元字符) 

"[^xyz]" 不匹配这个集合中的任何一个字符 

"[\b]" 匹配一个退格符 

"\b" 匹配一个单词的边界 

"\B" 匹配一个单词的非边界 

"\cX" 这儿，X是一个控制符，**/\cM/匹配Ctrl-M **

"\d" 匹配一个字数字符，**/\d/ = /[0-9]/ **

"\D" 匹配一个非数字字符，**/\D/ = /[^0-9]/** 

"\s" 匹配一个空白字符，包括\n,\r,\f,\t,\v等 

"\S" 匹配一个非空白字符，等于/[^\n\f\r\t\v]/ 

"\n" 匹配一个换行符 

"\r" 匹配一个回车符 

"\f" 匹配一个换页符

"\t" 匹配一个制表符 

"\v" 匹配一个顶头制表符 

"\w" 匹配一个可以组成单词的字符，包括下划线，**[\w]匹配"$5.98"中的5，等于[a-zA-Z0-9] **

"\W" 匹配一个不可以组成单词的字符，**[\W]匹配"$5.98"中的$，等于[^a-zA-Z0-9]，注意有中括号**

"\" 转义字符反斜杠, **匹配问号开头/^\?/**

### 4. 正则表达式的优先级 

1. \ 转义符
2. (), (?:), (?=), [] 圆括号和方括号
3. *, +, ?, {n}, {n,}, {n,m} 限定符
4. ^, $, \anymetacharacter 位置和顺序
5. |“或”操作

### 5. 正则表达式捕获组
捕获组就是把正则表达式中子表达式（即是用小括号括起来的内容）匹配的内容，保存到内存中以数字编号或显示命名的组里，方便后面使用，可以在正则表达式内部使用，

也可以在外部使用。

捕获组分组语法：(子表达式)

捕获性分组的编号规则：编号是按照”(”出现的顺序，从左到右，从1开始进行编号


{% highlight ruby %}
// 分组的列子
console.log(/(longen){2}/.test("longen")); // false
console.log(/(longen){2}/.test("longenlongen")); //true
// 分组的运用 RegExp.$1 获取小括号的分组
var str = 11122;
/(\d+)/.test(str);
console.log(RegExp.$1); // 11122

// 使用replace替换 使用分组 把内容替换
var num = "11 22";
var n = num.replace(/(\d+)\s*(\d+)/,"$2 $1");
console.log(n); // 22 11
{% endhighlight %}

### 6. 正则表达式非捕获性分组

要创建一个非捕获性分组，只要在分组的左括号的后面紧跟一个问号与冒号就ok，非捕获分组的含义我们可以理解为如下：子表达式可以作为被整体修饰但是子表达式匹配的结果不会被存储。

{% highlight ruby %}
// 非捕获性分组
var num2 = "11 22";
/#(?:\d+)/.test(num2);
console.log(RegExp.$1); //""
我们再来看下使用 非捕获性分组来把页面上的所有标签都去掉，如下代码：
// 把页面上所有的标签都移除掉
var html = "<p><a href='http://baidu.com'>我来测试下</a>by <em>龙恩</em></p>";
var text = html.replace(/<(?:.|\s)*?>/g, "");
console.log(text); // 我来测试下by 龙恩
{% endhighlight %}

  如上：我们来分析下：正则/<(?:.|\s)*?>/g 的含义是：g是修饰符，全局匹配的含义；使用非捕获性分组?: 的含义是 子表达式可以作为被整体修饰但是子表达式匹配的结果不会被存储；因此：正则/<(?:.|\s)*?>/g 的含义变为：匹配以< 开头 及 > 结束的所有字符；(?:.|\s)*? 含义是：. 代表任意字符，| 含义是或者的意思，\s 是匹配空格的意思；*号修饰符的含义是零个或者多个的意思；后面的?（问号）代表可匹配，可不匹配的含义；优先是可匹配；总起来的意思是：全局匹配字符串html 中的 以<开头 以>结尾的所有字符 替换成 空字符串，因此留下来就是文本。
  
### 7. 正则表达式反向引用

捕获性分组取到的内容，不仅可以在正则表达式外部通过程序进行引用，也可以在正则表达式内部进行引用，这种引用方式就叫做反向引用，并不是所有分组都能创建反向引用，非捕获性分组不能创建反向引用。

捕获性分组的反向引用的写法如：\number

Number是十进制数字，即捕获组的编号。

**反向引用的匹配原理**

捕获分组在匹配成功时，会将子表达式匹配到的内容，保存到内存中一个以数字编号的组里，可以简单的认为是对一个局部变量进行了赋值，这时就可以通过反向引用，引用这个局部变量的值。一个捕获分组在匹配成功之前，它的内容可以是不确定的，一旦匹配成功了，它的内容就确定了，反向引用的内容也就确定了。


{% highlight ruby %}
var str = "longenaabcd";
console.log(str.match(/([ab])\1/)[0]);//aa
{% endhighlight %}

代码分析：对于如上代码中的正则 /([ab])\1/, 捕获组中子表达式[ab]；可以匹配a，也可以匹配b，但是如果匹配成功的话，那么它的反向引用也就确定了，如果捕获分组匹配到的是a，那么它的反向引用就只能匹配a，如果捕获分组匹配到的是b，那么它的反向引用就只能匹配到b；\1的含义是 捕获分组匹配到是什么，那么它必须与捕获分组到是相同的字符；也就是说 只能匹配到aa或者bb才能匹配成功；


该正则匹配的过程我们可以来分析下：
  
字符串匹配正则/([ab])\1/, 在位置0处开始匹配，0处字符是l，很明显不满足，把控制权就交给下一个字符，一直到第6个字符，才匹配到a，匹配成功，把控制权交给\1, 也就是反向引用和分组中是相同的字符，因此也匹配a，字符串中下一个字符也是a，因此匹配成功，因此整个表达式找到匹配的字符，匹配的位置开始于6，结束与8；我们再可以匹配b。


### 8. 正则表达式环视


环视强调的是它所在的位置，前面或者后面，必须满足环视表达式中的匹配情况，才能匹配成功。

环视可以认为是虚拟加入到它所在位置的附加判断条件，并不消耗正则的匹配字符。

环视有顺序和逆序2种，顺序和逆序又分为肯定和否定，因此共加起来有四种；但是javascript中只支持顺序环视

如下说明：

(?=Expression):  

顺序肯定环视，含义是所在的位置右侧位置能够匹配到regexp.


(?!Expression)


顺序否定环视，含义是所在的位置右侧位置不能匹配到regexp


正则(?=A)[A-Z]匹配的是：

1. (?=A)所在的位置，后面是A
2. 表达式[A-Z]匹配A-Z中任意一个字母
3. 根据两个的先后位置关系，组合在一起，那就是：(?=A)所在的位置，后面是A，而且是A-Z中任意一个字母


### 9. 正则表达式几个常用实例说明

#### **匹配以数字结尾的**

正则：/\d+$/g;

#### **去掉空格**

var str = "我 是 龙 恩";

console.log(str.replace(/\s+/g,""));//我是龙恩

#### **校验是否全由数字组成**

/^[0-9]{1,20}$/或者/^\d*$/

^ 表示打头的字符要匹配紧跟^后面的规则

$ 表示打头的字符要匹配紧靠$前面的规则

[ ] 中的内容是可选字符集

[0-9] 表示要求字符范围在0-9之间

{1,20}表示数字字符串长度合法为1到20，即为[0-9]中的字符出现次数的范围是1到20次。

/^ 和 $/成对使用应该是表示要求整个字符串完全匹配定义的规则，而不是只匹配字符串中的一个子串。

#### **校验登录名：只能输入5-20个以字母开头、可带数字、“_”、“.”的字串**

/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){4,19}$/

^[a-zA-Z]{1} 表示第一个字符要求是字母。

([a-zA-Z0-9]|[._]){4,19} 表示从第二位开始（因为它紧跟在上个表达式后面）的一个长度为4到9位的字符串，它要求是由大小写字母、数字或者特殊字符集[._]组成。

#### **校验用户姓名：只能输入1-30个以字母开头的字串**

/^[a-zA-Z]{1,30}$/

#### **校验密码：只能输入6-20个字母、数字、下划线**

/^(\w){6,20}$/

\w：用于匹配字母，数字或下划线字符

#### **校验普通电话、传真号码：可以“+”或数字开头，可含有“-” 和 “ ”**

/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/

\d：用于匹配从0到9的数字；

“?”元字符规定其前导对象必须在目标对象中连续出现零次或一次

可以匹配的字符串如：+123 -999 999 ； +123-999 999 ；123 999 999 ；+123 999999等

#### **校验URL**

/^http[s]{0,1}:\/\/.+$/ 或 /^http[s]{0,1}:\/\/.{1,n}$/ 

 
 \ / ：表示字符“/”。
 
“.” 表示所有字符的集

“+” 等同于{1,}，就是1到正无穷


#### **校验纯中文字符**

/^[\u4E00-\u9FA5]+$/

[\u4E00-\u9FA5] ：估计是中文字符集的范围吧


#### **替换小数点前面的内容为指定内容**


var href = "aa.php?d=1";


var reg = href.replace(/\b^(\w*)(?=\.)/,"bb");


console.log(reg); // bb.php?d=1



#### **限制文本框只能输入数字和小数点(二位小数点)**

分析：开头有0个或者多个数字，中间有0个或者1个小数点，小数点后面有0个或者最多2个数字；

/^\d*\.?\d{0,2}$/





